<html>
<title>nostr-filter</title>
<script>
const original_console_log = console.log
console.log = (...args) => {
  const c = document.getElementById('console')
  args.forEach((a) => {
    original_console_log(a)
    c.value += `${a}\n`
  })
  c.scrollTo(0, c.scrollHeight)
}

const ws = new WebSocket('wss://' + location.hostname)

ws.onerror = function () {
  console.log('Connection Error')
}

ws.onopen = function () {
  ws.send(JSON.stringify(['REQ', crypto.randomUUID(), { kinds: [1], since: Math.floor(new Date()/1000 - 60*10) }]))
}

ws.onmessage = async function (e) {
  const event = JSON.parse(e.data)
  if (event[0] === 'EVENT') {
    const note = event[2]
    const date = new Date(note.created_at*1000)
    console.log("datetime : " + date.toLocaleDateString() + " " + date.toLocaleTimeString())
    console.log("pubkey   : " + note.pubkey)
    console.log("id       : " + note.id)
    console.log("")
    console.log(note.content)
    console.log("")
    console.log("===========================================================================")
  } else if (event[0] === 'EOSE') {
    // client.send(JSON.stringify(['CLOSE', event[1]]))
    // client.close()
  }
}
</script>
</head>
<body>
  <textarea id="console" style="width: 100%; height: 100%; overflow-y: scroll; word-break: break-all;" disabled></textarea>
</body>
</html>