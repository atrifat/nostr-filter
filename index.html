<html>
<title>Nostr Relay</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&family=Yusei+Magic&display=swap" rel="stylesheet">

<script>
  const original_console_log = console.log
  console.log = (...args) => {
    const c = document.getElementById('console')
    args.forEach((a) => {
      original_console_log(a)
      c.value += `${a}\n`
    })
    c.scrollTo(0, c.scrollHeight)
  }

  function connect() {
    const ws = new WebSocket("wss://" + location.hostname);

    ws.onclose = ws.onerror = function () {
      console.log("Connecting...");
      setTimeout(connect, 3000);
    };
    ws.onopen = function () {
      ws.send(
        // JSON.stringify(["REQ", crypto.randomUUID(), { kinds: [1], since: Math.floor(new Date() / 1000 - 60 * 10) }])
        JSON.stringify(["REQ", crypto.randomUUID(), { kinds: [1], limit: 1 }])
      );
    };
    ws.onmessage = async function (e) {
      const event = JSON.parse(e.data);
      if (event[0] === "EVENT") {
        const note = event[2];
        const date = new Date(note.created_at * 1000);
        const date_str =
          console.log(
            "datetime : " +
            date.toLocaleDateString() +
            " " +
            date.toLocaleTimeString()
          );
        console.log("pubkey   : " + note.pubkey);
        console.log("id       : " + note.id);
        console.log("");
        console.log(note.content);
        console.log("");
        console.log(
          "==========================================================================="
        );
      } else if (event[0] === "EOSE") {
        // client.send(JSON.stringify(['CLOSE', event[1]]))
        // client.close()
      }
    };
  }
  connect()
</script>
<style>
  #console {
    width: 100%;
    height: 100%;
    overflow-y: scroll;
    word-break: break-all;
    font-family: 'IBM Plex Mono', 'Yusei Magic', monospace;
  }
</style>
</head>

<body>
  <textarea id="console" disabled></textarea>
</body>

</html>